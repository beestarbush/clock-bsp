# clock-webapp lighttpd configuration
#
# Drop this into /etc/lighttpd/conf.d/ and ensure lighttpd's main config
# includes the conf.d directory with:
#   include_shell "cat /etc/lighttpd/conf.d/*.conf"

server.modules += (
    "mod_rewrite",
    "mod_proxy",
    "mod_wstunnel",
)

server.document-root = "/usr/share/bee/webapp"
server.port           = 80
index-file.names      = ("index.html")

# SPA fallback â€” serve index.html for any path that is not a real file
url.rewrite-if-not-file = ("^/(.*)$" => "/index.html")

# Proxy WebSocket connections to clock-backend
$HTTP["url"] =~ "^/ws" {
    wstunnel.server = (
        "/ws" => (( "host" => "127.0.0.1", "port" => 5000 ))
    )
    wstunnel.websocket-ping-interval = 60
}

# Proxy media file requests to clock-backend
$HTTP["url"] =~ "^/media" {
    proxy.server = (
        "/media" => (( "host" => "127.0.0.1", "port" => 5000 ))
    )
}
